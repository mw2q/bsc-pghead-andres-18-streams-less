BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%thistle%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 267202686.806888
 ALGERIA                   |   1997 | 463695028.962465
 ALGERIA                   |   1996 | 455821947.019025
 ALGERIA                   |   1995 | 457356727.687854
 ALGERIA                   |   1994 | 455000299.841335
 ALGERIA                   |   1993 | 452862908.440986
 ALGERIA                   |   1992 | 456965390.938491
 ARGENTINA                 |   1998 | 274017135.556353
 ARGENTINA                 |   1997 | 475605161.841142
 ARGENTINA                 |   1996 | 467535419.592921
 ARGENTINA                 |   1995 | 467571165.512229
 ARGENTINA                 |   1994 | 470044114.694278
 ARGENTINA                 |   1993 | 474955894.676692
 ARGENTINA                 |   1992 | 469163807.696577
 BRAZIL                    |   1998 | 269946473.173395
 BRAZIL                    |   1997 |  462088908.12552
 BRAZIL                    |   1996 | 459190529.836946
 BRAZIL                    |   1995 | 458021868.594871
 BRAZIL                    |   1994 | 457290050.728967
 BRAZIL                    |   1993 | 460762353.733109
 BRAZIL                    |   1992 | 466728580.960343
 CANADA                    |   1998 | 276691623.408304
 CANADA                    |   1997 | 477094556.841895
 CANADA                    |   1996 | 478981547.572872
 CANADA                    |   1995 |  472857779.65357
 CANADA                    |   1994 | 483624089.355201
 CANADA                    |   1993 | 480136389.220219
 CANADA                    |   1992 | 481595663.652542
 CHINA                     |   1998 | 270573876.103742
 CHINA                     |   1997 | 457784505.606893
 CHINA                     |   1996 | 459595350.424707
 CHINA                     |   1995 | 457382614.759553
 CHINA                     |   1994 | 459464201.172642
 CHINA                     |   1993 | 462653269.384826
 CHINA                     |   1992 | 464322926.129779
 EGYPT                     |   1998 | 268799664.829737
 EGYPT                     |   1997 | 464399830.934033
 EGYPT                     |   1996 | 458841588.665088
 EGYPT                     |   1995 | 468100692.020306
 EGYPT                     |   1994 | 459418648.443465
 EGYPT                     |   1993 |  460653066.79018
 EGYPT                     |   1992 |  463715310.31091
 ETHIOPIA                  |   1998 | 266508257.614782
 ETHIOPIA                  |   1997 | 458769022.178829
 ETHIOPIA                  |   1996 | 455726231.636282
 ETHIOPIA                  |   1995 | 458822049.588817
 ETHIOPIA                  |   1994 | 460333588.080634
 ETHIOPIA                  |   1993 | 453635369.870862
 ETHIOPIA                  |   1992 | 456888017.989442
 FRANCE                    |   1998 | 271858896.171312
 FRANCE                    |   1997 | 457819740.627757
 FRANCE                    |   1996 | 461255258.792779
 FRANCE                    |   1995 | 454509060.329593
 FRANCE                    |   1994 | 453559017.319927
 FRANCE                    |   1993 |  459325627.43519
 FRANCE                    |   1992 | 462746660.215101
 GERMANY                   |   1998 | 270860911.500423
 GERMANY                   |   1997 | 465307392.235987
 GERMANY                   |   1996 | 464457863.882843
 GERMANY                   |   1995 | 465569456.107641
 GERMANY                   |   1994 | 467902646.975486
 GERMANY                   |   1993 | 470388646.104205
 GERMANY                   |   1992 | 467213346.747366
 INDIA                     |   1998 | 274646834.938227
 INDIA                     |   1997 | 475293252.378648
 INDIA                     |   1996 | 474498659.489216
 INDIA                     |   1995 | 477926470.756633
 INDIA                     |   1994 | 474817613.732315
 INDIA                     |   1993 | 475010656.940884
 INDIA                     |   1992 | 470474041.482755
 INDONESIA                 |   1998 | 272213241.801513
 INDONESIA                 |   1997 | 449664549.109429
 INDONESIA                 |   1996 | 455253995.999592
 INDONESIA                 |   1995 | 455235296.580821
 INDONESIA                 |   1994 | 455377016.574212
 INDONESIA                 |   1993 | 461749407.948268
 INDONESIA                 |   1992 | 456945585.413242
 IRAN                      |   1998 | 264788518.712278
 IRAN                      |   1997 | 469835630.715555
 IRAN                      |   1996 | 461835934.992288
 IRAN                      |   1995 |  461860741.52533
 IRAN                      |   1994 | 459246591.321652
 IRAN                      |   1993 |  459646378.02018
 IRAN                      |   1992 | 465003196.521142
 IRAQ                      |   1998 | 272234188.197313
 IRAQ                      |   1997 | 466421183.511047
 IRAQ                      |   1996 | 471480130.417457
 IRAQ                      |   1995 | 464352388.912366
 IRAQ                      |   1994 | 466785695.278665
 IRAQ                      |   1993 | 462072428.238239
 IRAQ                      |   1992 | 465609988.744647
 JAPAN                     |   1998 | 270181540.003237
 JAPAN                     |   1997 | 451450270.496038
 JAPAN                     |   1996 | 455789673.776235
 JAPAN                     |   1995 | 454853538.361934
 JAPAN                     |   1994 | 452325562.006409
 JAPAN                     |   1993 | 464273276.956401
 JAPAN                     |   1992 | 451541637.442904
 JORDAN                    |   1998 | 268161839.166221
 JORDAN                    |   1997 | 457209682.607588
 JORDAN                    |   1996 | 458783066.969431
 JORDAN                    |   1995 | 447179372.968149
 JORDAN                    |   1994 | 455983688.130623
 JORDAN                    |   1993 | 453718332.821384
 JORDAN                    |   1992 | 457453335.492146
 KENYA                     |   1998 | 270736150.297687
 KENYA                     |   1997 | 464743058.041332
 KENYA                     |   1996 | 473386286.922922
 KENYA                     |   1995 | 466729913.372952
 KENYA                     |   1994 | 466111517.186788
 KENYA                     |   1993 | 474919229.591217
 KENYA                     |   1992 | 471871196.207364
 MOROCCO                   |   1998 | 266885696.113848
 MOROCCO                   |   1997 |  462887608.01508
 MOROCCO                   |   1996 | 462988594.343698
 MOROCCO                   |   1995 |  458544209.55356
 MOROCCO                   |   1994 | 458766675.165109
 MOROCCO                   |   1993 | 465536475.574867
 MOROCCO                   |   1992 | 465913607.195247
 MOZAMBIQUE                |   1998 |  269215084.32519
 MOZAMBIQUE                |   1997 | 449770041.649201
 MOZAMBIQUE                |   1996 | 455019341.725942
 MOZAMBIQUE                |   1995 | 452139768.062161
 MOZAMBIQUE                |   1994 | 457800735.522129
 MOZAMBIQUE                |   1993 | 455523447.340021
 MOZAMBIQUE                |   1992 | 448110810.730023
 PERU                      |   1998 | 269913974.799752
 PERU                      |   1997 | 464341278.126491
 PERU                      |   1996 | 467402219.018362
 PERU                      |   1995 | 456229645.394599
 PERU                      |   1994 | 466919640.271479
 PERU                      |   1993 | 465165186.701438
 PERU                      |   1992 | 460736401.756873
 ROMANIA                   |   1998 | 268367877.554866
 ROMANIA                   |   1997 | 458738773.934745
 ROMANIA                   |   1996 |   461301962.8229
 ROMANIA                   |   1995 | 456541575.316848
 ROMANIA                   |   1994 | 464391831.165421
 ROMANIA                   |   1993 | 460282226.412565
 ROMANIA                   |   1992 | 465297024.027434
 RUSSIA                    |   1998 |   280383580.7377
 RUSSIA                    |   1997 | 467265591.690707
 RUSSIA                    |   1996 | 467131538.261167
 RUSSIA                    |   1995 | 472389734.436482
 RUSSIA                    |   1994 | 470401638.019351
 RUSSIA                    |   1993 | 476248292.491474
 RUSSIA                    |   1992 | 466617513.621778
 SAUDI ARABIA              |   1998 | 270595516.125131
 SAUDI ARABIA              |   1997 | 457215541.505693
 SAUDI ARABIA              |   1996 | 465506482.684939
 SAUDI ARABIA              |   1995 | 467980751.027959
 SAUDI ARABIA              |   1994 | 464031956.710811
 SAUDI ARABIA              |   1993 | 463162385.833207
 SAUDI ARABIA              |   1992 | 467693641.427986
 UNITED KINGDOM            |   1998 | 267002100.663279
 UNITED KINGDOM            |   1997 | 460436615.956458
 UNITED KINGDOM            |   1996 | 458497321.411569
 UNITED KINGDOM            |   1995 | 462308121.357984
 UNITED KINGDOM            |   1994 |   462639788.6545
 UNITED KINGDOM            |   1993 |  467162944.94774
 UNITED KINGDOM            |   1992 | 457512053.207944
 UNITED STATES             |   1998 | 274053587.035567
 UNITED STATES             |   1997 | 468209423.908854
 UNITED STATES             |   1996 |  477397292.79261
 UNITED STATES             |   1995 | 465751416.390522
 UNITED STATES             |   1994 | 474934432.127014
 UNITED STATES             |   1993 | 469272504.982791
 UNITED STATES             |   1992 | 472628189.345094
 VIETNAM                   |   1998 | 271466712.919549
 VIETNAM                   |   1997 | 465585557.435728
 VIETNAM                   |   1996 | 461212920.066649
 VIETNAM                   |   1995 | 460070186.770619
 VIETNAM                   |   1994 | 465265029.218893
 VIETNAM                   |   1993 | 467447191.485797
 VIETNAM                   |   1992 |  462258246.12283
(175 rows)

COMMIT;
COMMIT
