BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%ghost%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 272291566.888363
 ALGERIA                   |   1997 |  460009513.77401
 ALGERIA                   |   1996 | 467282277.975134
 ALGERIA                   |   1995 | 466829828.348853
 ALGERIA                   |   1994 | 457901178.321163
 ALGERIA                   |   1993 | 470527926.957702
 ALGERIA                   |   1992 | 464650599.135562
 ARGENTINA                 |   1998 | 276609473.248924
 ARGENTINA                 |   1997 | 471677826.028137
 ARGENTINA                 |   1996 | 475535846.206737
 ARGENTINA                 |   1995 | 471011075.300222
 ARGENTINA                 |   1994 | 466378794.558429
 ARGENTINA                 |   1993 | 466552172.279648
 ARGENTINA                 |   1992 | 469536231.452804
 BRAZIL                    |   1998 | 271870356.228352
 BRAZIL                    |   1997 | 464325524.680227
 BRAZIL                    |   1996 | 469020629.591622
 BRAZIL                    |   1995 | 470662441.383755
 BRAZIL                    |   1994 | 464295385.562027
 BRAZIL                    |   1993 |  463457494.18578
 BRAZIL                    |   1992 | 471769727.311335
 CANADA                    |   1998 | 274427949.609771
 CANADA                    |   1997 | 479122632.554652
 CANADA                    |   1996 | 473023761.383495
 CANADA                    |   1995 | 477927172.872256
 CANADA                    |   1994 | 479885627.525853
 CANADA                    |   1993 | 483210055.066976
 CANADA                    |   1992 | 485243422.733005
 CHINA                     |   1998 |  280107343.91711
 CHINA                     |   1997 | 468183691.518654
 CHINA                     |   1996 | 477329701.740826
 CHINA                     |   1995 | 474224581.114383
 CHINA                     |   1994 | 471605222.588734
 CHINA                     |   1993 |  478212414.48113
 CHINA                     |   1992 | 476796402.263293
 EGYPT                     |   1998 | 275887326.391913
 EGYPT                     |   1997 | 458782261.427569
 EGYPT                     |   1996 | 464787616.833652
 EGYPT                     |   1995 | 465439124.031431
 EGYPT                     |   1994 | 462876611.252513
 EGYPT                     |   1993 | 460722568.459956
 EGYPT                     |   1992 | 468671329.864283
 ETHIOPIA                  |   1998 | 266939024.222049
 ETHIOPIA                  |   1997 | 453386220.362172
 ETHIOPIA                  |   1996 | 458944313.797272
 ETHIOPIA                  |   1995 | 460659683.317054
 ETHIOPIA                  |   1994 |  456762441.55644
 ETHIOPIA                  |   1993 | 456625769.233826
 ETHIOPIA                  |   1992 | 457961811.798417
 FRANCE                    |   1998 | 271496845.884805
 FRANCE                    |   1997 |  459735680.32352
 FRANCE                    |   1996 |  461023327.27636
 FRANCE                    |   1995 | 465148316.670512
 FRANCE                    |   1994 | 456219682.721543
 FRANCE                    |   1993 | 465622356.882064
 FRANCE                    |   1992 | 459793792.025447
 GERMANY                   |   1998 | 277588527.426416
 GERMANY                   |   1997 | 476291067.910873
 GERMANY                   |   1996 | 468822913.076766
 GERMANY                   |   1995 | 471297747.989824
 GERMANY                   |   1994 | 474227399.334723
 GERMANY                   |   1993 | 466746387.575993
 GERMANY                   |   1992 | 461944607.937563
 INDIA                     |   1998 | 270303124.460519
 INDIA                     |   1997 |  469464721.90984
 INDIA                     |   1996 | 476514684.583171
 INDIA                     |   1995 | 467238511.974527
 INDIA                     |   1994 | 463730167.504881
 INDIA                     |   1993 | 463351855.679792
 INDIA                     |   1992 | 466890190.345276
 INDONESIA                 |   1998 | 273387301.032178
 INDONESIA                 |   1997 | 456930633.176487
 INDONESIA                 |   1996 | 460451290.547727
 INDONESIA                 |   1995 | 464796794.007259
 INDONESIA                 |   1994 |  454727334.99585
 INDONESIA                 |   1993 | 461217478.795408
 INDONESIA                 |   1992 | 468505347.686137
 IRAN                      |   1998 | 272855216.034584
 IRAN                      |   1997 | 462034113.535507
 IRAN                      |   1996 | 461584097.151369
 IRAN                      |   1995 | 460549899.639705
 IRAN                      |   1994 | 467853071.997543
 IRAN                      |   1993 | 462584533.965886
 IRAN                      |   1992 | 468684864.239352
 IRAQ                      |   1998 | 280288689.739896
 IRAQ                      |   1997 | 472142395.534292
 IRAQ                      |   1996 | 480192922.421709
 IRAQ                      |   1995 | 477139992.847297
 IRAQ                      |   1994 | 481511084.537179
 IRAQ                      |   1993 | 467275565.429912
 IRAQ                      |   1992 | 478612955.919955
 JAPAN                     |   1998 | 274699714.060844
 JAPAN                     |   1997 | 469088508.198664
 JAPAN                     |   1996 | 458834614.184578
 JAPAN                     |   1995 | 461822834.054541
 JAPAN                     |   1994 | 462284803.792849
 JAPAN                     |   1993 | 462897598.872228
 JAPAN                     |   1992 | 463340072.732364
 JORDAN                    |   1998 | 274526753.757893
 JORDAN                    |   1997 | 468698592.740041
 JORDAN                    |   1996 | 461236130.347921
 JORDAN                    |   1995 | 465250421.661681
 JORDAN                    |   1994 | 459009635.273903
 JORDAN                    |   1993 |  461065897.18019
 JORDAN                    |   1992 | 459269119.483328
 KENYA                     |   1998 | 272433398.102475
 KENYA                     |   1997 | 471228839.940748
 KENYA                     |   1996 | 474395386.729005
 KENYA                     |   1995 | 473570203.735608
 KENYA                     |   1994 | 468931768.815726
 KENYA                     |   1993 | 479542499.459674
 KENYA                     |   1992 |  473950976.64397
 MOROCCO                   |   1998 | 278010341.667378
 MOROCCO                   |   1997 | 475702171.893485
 MOROCCO                   |   1996 | 477432949.182786
 MOROCCO                   |   1995 | 474904786.944168
 MOROCCO                   |   1994 | 473975364.974101
 MOROCCO                   |   1993 | 473582230.136652
 MOROCCO                   |   1992 |  468971367.55833
 MOZAMBIQUE                |   1998 | 271053691.907131
 MOZAMBIQUE                |   1997 | 453297675.968158
 MOZAMBIQUE                |   1996 | 459509518.395826
 MOZAMBIQUE                |   1995 | 462057369.116935
 MOZAMBIQUE                |   1994 | 459144135.304323
 MOZAMBIQUE                |   1993 | 459411903.549359
 MOZAMBIQUE                |   1992 | 451692586.234863
 PERU                      |   1998 | 275181643.640172
 PERU                      |   1997 | 464659794.245405
 PERU                      |   1996 | 467380610.432925
 PERU                      |   1995 | 470439759.726325
 PERU                      |   1994 | 461683848.216331
 PERU                      |   1993 | 463315286.328985
 PERU                      |   1992 | 466998150.318027
 ROMANIA                   |   1998 |  277083287.05469
 ROMANIA                   |   1997 | 470224090.510173
 ROMANIA                   |   1996 |  470926196.56616
 ROMANIA                   |   1995 | 475992947.069347
 ROMANIA                   |   1994 | 469827722.693027
 ROMANIA                   |   1993 |  472797577.23067
 ROMANIA                   |   1992 | 474928681.375992
 RUSSIA                    |   1998 | 274816923.092086
 RUSSIA                    |   1997 | 471147104.884488
 RUSSIA                    |   1996 | 473941640.475102
 RUSSIA                    |   1995 | 462658687.901974
 RUSSIA                    |   1994 | 475873948.437987
 RUSSIA                    |   1993 | 471211672.481575
 RUSSIA                    |   1992 | 471467721.637269
 SAUDI ARABIA              |   1998 | 271699830.415314
 SAUDI ARABIA              |   1997 | 483552550.830692
 SAUDI ARABIA              |   1996 | 472972010.990552
 SAUDI ARABIA              |   1995 | 475509990.405721
 SAUDI ARABIA              |   1994 | 473996429.981414
 SAUDI ARABIA              |   1993 | 464515204.888106
 SAUDI ARABIA              |   1992 | 472325536.384873
 UNITED KINGDOM            |   1998 | 267745217.146717
 UNITED KINGDOM            |   1997 | 459295315.815416
 UNITED KINGDOM            |   1996 | 462789919.385869
 UNITED KINGDOM            |   1995 | 450002174.328653
 UNITED KINGDOM            |   1994 | 457056716.191099
 UNITED KINGDOM            |   1993 | 448244032.703164
 UNITED KINGDOM            |   1992 | 461214437.252913
 UNITED STATES             |   1998 | 271145539.121362
 UNITED STATES             |   1997 | 464980461.475398
 UNITED STATES             |   1996 |  464504801.29792
 UNITED STATES             |   1995 | 461363641.074166
 UNITED STATES             |   1994 | 473439516.950741
 UNITED STATES             |   1993 |  471608256.58644
 UNITED STATES             |   1992 | 461838468.218727
 VIETNAM                   |   1998 | 275006282.237076
 VIETNAM                   |   1997 | 468907997.027037
 VIETNAM                   |   1996 | 484477436.167371
 VIETNAM                   |   1995 | 471809827.176958
 VIETNAM                   |   1994 | 478494929.325016
 VIETNAM                   |   1993 | 468543072.974989
 VIETNAM                   |   1992 | 470068151.152342
(175 rows)

COMMIT;
COMMIT
