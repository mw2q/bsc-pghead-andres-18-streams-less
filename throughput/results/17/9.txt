BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%snow%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 267949161.572797
 ALGERIA                   |   1997 | 446690291.408706
 ALGERIA                   |   1996 | 468205591.550845
 ALGERIA                   |   1995 | 463881109.079495
 ALGERIA                   |   1994 | 462021264.988951
 ALGERIA                   |   1993 |  463183041.43907
 ALGERIA                   |   1992 | 462617416.891651
 ARGENTINA                 |   1998 | 271355252.388672
 ARGENTINA                 |   1997 | 467096151.471881
 ARGENTINA                 |   1996 | 463228750.404059
 ARGENTINA                 |   1995 | 458652158.949176
 ARGENTINA                 |   1994 | 475067499.386795
 ARGENTINA                 |   1993 | 458577719.346167
 ARGENTINA                 |   1992 | 465113681.431461
 BRAZIL                    |   1998 | 272562520.588959
 BRAZIL                    |   1997 |  461503007.20785
 BRAZIL                    |   1996 | 463939352.962789
 BRAZIL                    |   1995 | 462236823.062589
 BRAZIL                    |   1994 | 468526428.105465
 BRAZIL                    |   1993 | 462670984.663191
 BRAZIL                    |   1992 |  462780892.82182
 CANADA                    |   1998 | 282304880.465587
 CANADA                    |   1997 | 484395351.611724
 CANADA                    |   1996 |  489496695.20529
 CANADA                    |   1995 | 486739712.552076
 CANADA                    |   1994 | 485770002.480389
 CANADA                    |   1993 | 480518965.943171
 CANADA                    |   1992 | 485731555.907394
 CHINA                     |   1998 | 274672456.772608
 CHINA                     |   1997 | 468897065.404651
 CHINA                     |   1996 | 462231988.134117
 CHINA                     |   1995 | 460589176.363222
 CHINA                     |   1994 | 466495166.363631
 CHINA                     |   1993 | 463193205.531802
 CHINA                     |   1992 | 465405446.037017
 EGYPT                     |   1998 | 271750610.592877
 EGYPT                     |   1997 | 462005520.108302
 EGYPT                     |   1996 | 460300323.152354
 EGYPT                     |   1995 |  466725688.54541
 EGYPT                     |   1994 | 468046467.468937
 EGYPT                     |   1993 | 466146534.334767
 EGYPT                     |   1992 | 461346645.470086
 ETHIOPIA                  |   1998 | 271279252.286604
 ETHIOPIA                  |   1997 | 473750160.322744
 ETHIOPIA                  |   1996 | 455938436.695757
 ETHIOPIA                  |   1995 | 466584198.960993
 ETHIOPIA                  |   1994 | 472243524.426603
 ETHIOPIA                  |   1993 | 457739671.870065
 ETHIOPIA                  |   1992 | 456912993.053997
 FRANCE                    |   1998 |  270296249.17148
 FRANCE                    |   1997 | 460655329.860271
 FRANCE                    |   1996 | 460334757.310767
 FRANCE                    |   1995 | 462790128.012355
 FRANCE                    |   1994 | 463090620.460358
 FRANCE                    |   1993 | 464628254.668485
 FRANCE                    |   1992 |  462614483.02225
 GERMANY                   |   1998 | 279051878.132519
 GERMANY                   |   1997 | 477984496.121346
 GERMANY                   |   1996 | 463940957.502065
 GERMANY                   |   1995 | 477557658.203663
 GERMANY                   |   1994 | 473417579.960024
 GERMANY                   |   1993 | 475107100.847817
 GERMANY                   |   1992 | 475384573.233188
 INDIA                     |   1998 | 271944389.156535
 INDIA                     |   1997 | 474946209.189824
 INDIA                     |   1996 | 475755282.971546
 INDIA                     |   1995 | 462263448.032652
 INDIA                     |   1994 | 474780845.582038
 INDIA                     |   1993 | 469870200.048423
 INDIA                     |   1992 | 469062415.016957
 INDONESIA                 |   1998 | 268335528.725027
 INDONESIA                 |   1997 | 458405194.009795
 INDONESIA                 |   1996 | 467102836.210902
 INDONESIA                 |   1995 |  452743182.41566
 INDONESIA                 |   1994 | 456690867.554568
 INDONESIA                 |   1993 | 465664603.295149
 INDONESIA                 |   1992 |  458638101.24714
 IRAN                      |   1998 | 275787789.654914
 IRAN                      |   1997 | 464028551.770538
 IRAN                      |   1996 | 475442496.358005
 IRAN                      |   1995 | 455923363.268667
 IRAN                      |   1994 | 463324881.201239
 IRAN                      |   1993 |  464692042.73627
 IRAN                      |   1992 | 467938400.972517
 IRAQ                      |   1998 | 288191138.777102
 IRAQ                      |   1997 | 472866284.190329
 IRAQ                      |   1996 | 485459606.102759
 IRAQ                      |   1995 | 476561493.262455
 IRAQ                      |   1994 | 482521871.835717
 IRAQ                      |   1993 |  472655284.82813
 IRAQ                      |   1992 | 480566596.991762
 JAPAN                     |   1998 |  271787543.75722
 JAPAN                     |   1997 | 466770735.258342
 JAPAN                     |   1996 |  465602292.73247
 JAPAN                     |   1995 | 470484119.479934
 JAPAN                     |   1994 | 464581729.916104
 JAPAN                     |   1993 | 458584432.318942
 JAPAN                     |   1992 | 467736773.098624
 JORDAN                    |   1998 | 268671903.534145
 JORDAN                    |   1997 | 457196680.981267
 JORDAN                    |   1996 | 461652824.385944
 JORDAN                    |   1995 | 453030610.169053
 JORDAN                    |   1994 | 459328619.608737
 JORDAN                    |   1993 | 454403658.310242
 JORDAN                    |   1992 | 460223873.017678
 KENYA                     |   1998 | 280297608.168815
 KENYA                     |   1997 | 468167883.877182
 KENYA                     |   1996 | 480059560.990501
 KENYA                     |   1995 | 471631584.641219
 KENYA                     |   1994 |  478164359.83695
 KENYA                     |   1993 | 468974446.960208
 KENYA                     |   1992 | 474812549.919242
 MOROCCO                   |   1998 | 269333816.228834
 MOROCCO                   |   1997 | 466391977.605818
 MOROCCO                   |   1996 | 465205891.817335
 MOROCCO                   |   1995 | 462577600.713849
 MOROCCO                   |   1994 | 470691912.351648
 MOROCCO                   |   1993 | 465091393.655086
 MOROCCO                   |   1992 | 460116508.781504
 MOZAMBIQUE                |   1998 | 267008407.208484
 MOZAMBIQUE                |   1997 |  458708844.05916
 MOZAMBIQUE                |   1996 |  457856233.72809
 MOZAMBIQUE                |   1995 | 457016785.619584
 MOZAMBIQUE                |   1994 | 459507680.884154
 MOZAMBIQUE                |   1993 |  465153670.54278
 MOZAMBIQUE                |   1992 | 454988956.562081
 PERU                      |   1998 | 274498841.860407
 PERU                      |   1997 | 466689381.830323
 PERU                      |   1996 | 467179485.595289
 PERU                      |   1995 |  481054030.29732
 PERU                      |   1994 | 469543500.750873
 PERU                      |   1993 |  464082319.75231
 PERU                      |   1992 | 470120685.807606
 ROMANIA                   |   1998 | 271064016.601681
 ROMANIA                   |   1997 | 465613342.455635
 ROMANIA                   |   1996 | 474349409.038461
 ROMANIA                   |   1995 | 473427072.781442
 ROMANIA                   |   1994 | 466661875.862039
 ROMANIA                   |   1993 | 469112020.101262
 ROMANIA                   |   1992 | 464101961.246983
 RUSSIA                    |   1998 | 283817351.870779
 RUSSIA                    |   1997 | 479530003.736236
 RUSSIA                    |   1996 | 479088781.275569
 RUSSIA                    |   1995 |  465879585.64268
 RUSSIA                    |   1994 | 475769092.182136
 RUSSIA                    |   1993 | 469798307.556012
 RUSSIA                    |   1992 | 470576066.977007
 SAUDI ARABIA              |   1998 | 274989964.133039
 SAUDI ARABIA              |   1997 | 465565816.047565
 SAUDI ARABIA              |   1996 | 468612192.634654
 SAUDI ARABIA              |   1995 | 467228436.926882
 SAUDI ARABIA              |   1994 | 467325569.530831
 SAUDI ARABIA              |   1993 | 459851126.470732
 SAUDI ARABIA              |   1992 | 469533129.917991
 UNITED KINGDOM            |   1998 | 267874556.280596
 UNITED KINGDOM            |   1997 | 462660738.076705
 UNITED KINGDOM            |   1996 | 458037643.187632
 UNITED KINGDOM            |   1995 | 456749003.156383
 UNITED KINGDOM            |   1994 | 457451763.700388
 UNITED KINGDOM            |   1993 | 465531699.274844
 UNITED KINGDOM            |   1992 | 453372518.095617
 UNITED STATES             |   1998 | 271598772.655421
 UNITED STATES             |   1997 |  470677254.02987
 UNITED STATES             |   1996 | 461429841.699437
 UNITED STATES             |   1995 | 466768048.875098
 UNITED STATES             |   1994 | 461648484.075241
 UNITED STATES             |   1993 | 471033056.455857
 UNITED STATES             |   1992 | 468168668.818583
 VIETNAM                   |   1998 | 274942728.158095
 VIETNAM                   |   1997 | 464461652.623875
 VIETNAM                   |   1996 | 471369965.570587
 VIETNAM                   |   1995 | 465778447.683912
 VIETNAM                   |   1994 | 469275216.675065
 VIETNAM                   |   1993 | 458509636.817778
 VIETNAM                   |   1992 | 460832534.984441
(175 rows)

COMMIT;
COMMIT
