BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%sandy%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |  272255929.19555
 ALGERIA                   |   1997 | 452877902.195548
 ALGERIA                   |   1996 | 456803337.633203
 ALGERIA                   |   1995 | 465702321.771498
 ALGERIA                   |   1994 | 451683924.953125
 ALGERIA                   |   1993 | 461894749.169017
 ALGERIA                   |   1992 | 460762069.639987
 ARGENTINA                 |   1998 | 271051935.917215
 ARGENTINA                 |   1997 | 466734326.836949
 ARGENTINA                 |   1996 | 463972078.178373
 ARGENTINA                 |   1995 | 461981803.719598
 ARGENTINA                 |   1994 | 468756517.566811
 ARGENTINA                 |   1993 | 465108072.591019
 ARGENTINA                 |   1992 | 465623823.725388
 BRAZIL                    |   1998 | 275082889.254517
 BRAZIL                    |   1997 | 473704131.902902
 BRAZIL                    |   1996 | 462670419.663081
 BRAZIL                    |   1995 | 465020801.564215
 BRAZIL                    |   1994 | 468618490.006627
 BRAZIL                    |   1993 | 468378692.105376
 BRAZIL                    |   1992 | 471440061.617134
 CANADA                    |   1998 | 278443218.160614
 CANADA                    |   1997 | 482982775.240788
 CANADA                    |   1996 |  479462976.74129
 CANADA                    |   1995 | 487225336.861575
 CANADA                    |   1994 | 490214480.052423
 CANADA                    |   1993 | 480240542.855694
 CANADA                    |   1992 | 480620952.645845
 CHINA                     |   1998 | 275123181.731828
 CHINA                     |   1997 | 463396255.053243
 CHINA                     |   1996 | 461700801.835731
 CHINA                     |   1995 | 468835288.188789
 CHINA                     |   1994 | 466498409.911576
 CHINA                     |   1993 | 465495742.218575
 CHINA                     |   1992 | 466585841.196125
 EGYPT                     |   1998 | 270116637.842257
 EGYPT                     |   1997 |  462541203.03194
 EGYPT                     |   1996 |  465365839.11218
 EGYPT                     |   1995 | 472033500.342304
 EGYPT                     |   1994 | 463128459.861508
 EGYPT                     |   1993 |  469874376.01621
 EGYPT                     |   1992 | 471450816.588539
 ETHIOPIA                  |   1998 | 266580123.606652
 ETHIOPIA                  |   1997 | 457317619.238281
 ETHIOPIA                  |   1996 | 456009529.250983
 ETHIOPIA                  |   1995 | 457109325.114683
 ETHIOPIA                  |   1994 | 458056715.157358
 ETHIOPIA                  |   1993 | 456670348.650046
 ETHIOPIA                  |   1992 | 471265146.686316
 FRANCE                    |   1998 | 275730271.242439
 FRANCE                    |   1997 | 466210420.421446
 FRANCE                    |   1996 | 466285756.687754
 FRANCE                    |   1995 | 474034784.061102
 FRANCE                    |   1994 | 463179780.801747
 FRANCE                    |   1993 | 461316329.809537
 FRANCE                    |   1992 | 460694333.061126
 GERMANY                   |   1998 | 274837544.185062
 GERMANY                   |   1997 | 480994920.949755
 GERMANY                   |   1996 | 478648965.564276
 GERMANY                   |   1995 | 472717340.790654
 GERMANY                   |   1994 | 471821468.459845
 GERMANY                   |   1993 | 480454384.584492
 GERMANY                   |   1992 | 475641612.011439
 INDIA                     |   1998 | 284856980.077762
 INDIA                     |   1997 | 479741953.089051
 INDIA                     |   1996 | 473183299.928603
 INDIA                     |   1995 | 475009219.414554
 INDIA                     |   1994 | 480418315.242265
 INDIA                     |   1993 | 477471242.474838
 INDIA                     |   1992 | 475245665.730471
 INDONESIA                 |   1998 | 267990970.332147
 INDONESIA                 |   1997 | 455777544.840261
 INDONESIA                 |   1996 | 459198871.999344
 INDONESIA                 |   1995 | 450123863.859028
 INDONESIA                 |   1994 |  459020581.19685
 INDONESIA                 |   1993 | 451351758.176186
 INDONESIA                 |   1992 | 453442069.593718
 IRAN                      |   1998 | 271362082.153025
 IRAN                      |   1997 | 468831158.905647
 IRAN                      |   1996 | 472159201.765658
 IRAN                      |   1995 | 464544291.974125
 IRAN                      |   1994 | 473321827.856319
 IRAN                      |   1993 | 467139907.601861
 IRAN                      |   1992 | 467333731.016643
 IRAQ                      |   1998 | 275781563.613637
 IRAQ                      |   1997 | 472590629.501797
 IRAQ                      |   1996 | 473070399.691002
 IRAQ                      |   1995 | 479875891.541061
 IRAQ                      |   1994 | 472889535.594516
 IRAQ                      |   1993 | 471904907.845571
 IRAQ                      |   1992 | 474918631.523369
 JAPAN                     |   1998 | 271982161.602383
 JAPAN                     |   1997 | 464504634.240954
 JAPAN                     |   1996 | 464750139.566394
 JAPAN                     |   1995 | 469478274.880059
 JAPAN                     |   1994 | 465849853.904307
 JAPAN                     |   1993 | 464471995.913911
 JAPAN                     |   1992 | 470221093.726936
 JORDAN                    |   1998 |  264565310.66111
 JORDAN                    |   1997 | 453175089.966575
 JORDAN                    |   1996 |  456424450.31436
 JORDAN                    |   1995 | 453786681.953406
 JORDAN                    |   1994 | 459612379.936813
 JORDAN                    |   1993 | 465527891.523712
 JORDAN                    |   1992 | 460756728.878273
 KENYA                     |   1998 | 273334545.528897
 KENYA                     |   1997 |  469071103.35561
 KENYA                     |   1996 |   470416690.3216
 KENYA                     |   1995 | 468959676.710728
 KENYA                     |   1994 | 470924885.064079
 KENYA                     |   1993 | 467648287.857675
 KENYA                     |   1992 | 468293518.576682
 MOROCCO                   |   1998 | 277691218.486042
 MOROCCO                   |   1997 | 473532253.211363
 MOROCCO                   |   1996 | 469841041.501155
 MOROCCO                   |   1995 | 472492804.317615
 MOROCCO                   |   1994 | 474686966.071294
 MOROCCO                   |   1993 | 468545629.115235
 MOROCCO                   |   1992 | 461651774.590129
 MOZAMBIQUE                |   1998 | 272843036.154262
 MOZAMBIQUE                |   1997 | 452572892.415631
 MOZAMBIQUE                |   1996 | 452347324.004435
 MOZAMBIQUE                |   1995 | 454625148.848499
 MOZAMBIQUE                |   1994 | 459151964.186868
 MOZAMBIQUE                |   1993 | 450727772.256696
 MOZAMBIQUE                |   1992 | 453122134.335935
 PERU                      |   1998 |   266456743.3086
 PERU                      |   1997 | 455234619.705426
 PERU                      |   1996 | 462043448.568655
 PERU                      |   1995 | 462985543.367317
 PERU                      |   1994 | 470965638.013204
 PERU                      |   1993 | 457992312.753225
 PERU                      |   1992 | 467057785.492904
 ROMANIA                   |   1998 | 271887251.670705
 ROMANIA                   |   1997 | 460714946.652125
 ROMANIA                   |   1996 | 462018068.411849
 ROMANIA                   |   1995 | 462742029.814655
 ROMANIA                   |   1994 | 458400460.065758
 ROMANIA                   |   1993 | 456067904.500248
 ROMANIA                   |   1992 |  471722164.51257
 RUSSIA                    |   1998 | 270830752.421207
 RUSSIA                    |   1997 | 468247990.768012
 RUSSIA                    |   1996 | 489229126.915745
 RUSSIA                    |   1995 | 474600288.639792
 RUSSIA                    |   1994 | 478727958.219333
 RUSSIA                    |   1993 | 474189244.818772
 RUSSIA                    |   1992 | 479170529.274283
 SAUDI ARABIA              |   1998 | 274756248.557435
 SAUDI ARABIA              |   1997 | 471687094.250033
 SAUDI ARABIA              |   1996 | 469494928.319741
 SAUDI ARABIA              |   1995 | 468692236.444341
 SAUDI ARABIA              |   1994 | 464864852.396583
 SAUDI ARABIA              |   1993 |  467968730.04877
 SAUDI ARABIA              |   1992 | 472203699.622994
 UNITED KINGDOM            |   1998 | 274813435.324024
 UNITED KINGDOM            |   1997 | 471528070.184686
 UNITED KINGDOM            |   1996 | 474024916.246653
 UNITED KINGDOM            |   1995 | 464226797.656669
 UNITED KINGDOM            |   1994 | 470541626.430122
 UNITED KINGDOM            |   1993 | 469086623.210789
 UNITED KINGDOM            |   1992 | 471042760.766197
 UNITED STATES             |   1998 | 277220495.776087
 UNITED STATES             |   1997 | 472935530.244274
 UNITED STATES             |   1996 | 479188917.385869
 UNITED STATES             |   1995 | 473520090.726845
 UNITED STATES             |   1994 | 477406145.626335
 UNITED STATES             |   1993 | 480080162.150064
 UNITED STATES             |   1992 | 472242150.255159
 VIETNAM                   |   1998 | 270222394.921229
 VIETNAM                   |   1997 | 455396008.635145
 VIETNAM                   |   1996 | 465253834.621464
 VIETNAM                   |   1995 |  458576443.13398
 VIETNAM                   |   1994 | 457339020.931042
 VIETNAM                   |   1993 | 462378671.097932
 VIETNAM                   |   1992 | 459296446.270786
(175 rows)

COMMIT;
COMMIT
