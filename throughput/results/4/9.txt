BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%puff%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 261419369.392663
 ALGERIA                   |   1997 |  453757577.26205
 ALGERIA                   |   1996 | 454139477.864002
 ALGERIA                   |   1995 | 445773670.475965
 ALGERIA                   |   1994 | 451489598.517717
 ALGERIA                   |   1993 | 452248907.178345
 ALGERIA                   |   1992 | 455600335.117598
 ARGENTINA                 |   1998 | 273655671.398634
 ARGENTINA                 |   1997 | 469740368.272936
 ARGENTINA                 |   1996 | 478086618.592605
 ARGENTINA                 |   1995 | 471277776.842575
 ARGENTINA                 |   1994 | 464323840.466273
 ARGENTINA                 |   1993 | 471352857.043666
 ARGENTINA                 |   1992 | 466622086.971289
 BRAZIL                    |   1998 | 272919437.131478
 BRAZIL                    |   1997 | 469747986.504488
 BRAZIL                    |   1996 | 461485277.083065
 BRAZIL                    |   1995 | 463713026.228797
 BRAZIL                    |   1994 | 466483717.350019
 BRAZIL                    |   1993 | 465399470.940969
 BRAZIL                    |   1992 | 477759224.225384
 CANADA                    |   1998 | 277988599.057678
 CANADA                    |   1997 | 476453626.549888
 CANADA                    |   1996 | 476575590.324063
 CANADA                    |   1995 | 478821265.478969
 CANADA                    |   1994 | 479408487.260638
 CANADA                    |   1993 | 469800055.230221
 CANADA                    |   1992 | 475770182.049768
 CHINA                     |   1998 |  273273253.39722
 CHINA                     |   1997 | 463795518.948696
 CHINA                     |   1996 | 459889816.628421
 CHINA                     |   1995 | 455420327.959478
 CHINA                     |   1994 | 461111796.460067
 CHINA                     |   1993 | 465099094.212765
 CHINA                     |   1992 | 462414134.561542
 EGYPT                     |   1998 |  265701645.31661
 EGYPT                     |   1997 | 457472778.542378
 EGYPT                     |   1996 | 464419561.043969
 EGYPT                     |   1995 | 458998960.672398
 EGYPT                     |   1994 | 461535181.147349
 EGYPT                     |   1993 | 451444003.305648
 EGYPT                     |   1992 | 456794364.478368
 ETHIOPIA                  |   1998 | 269050984.026766
 ETHIOPIA                  |   1997 | 464831779.514618
 ETHIOPIA                  |   1996 | 462987639.502203
 ETHIOPIA                  |   1995 | 469801402.202435
 ETHIOPIA                  |   1994 | 466647316.501819
 ETHIOPIA                  |   1993 | 467675370.374424
 ETHIOPIA                  |   1992 | 471211919.086866
 FRANCE                    |   1998 | 266946253.020623
 FRANCE                    |   1997 | 449426969.624206
 FRANCE                    |   1996 | 461022155.448204
 FRANCE                    |   1995 | 461388085.677811
 FRANCE                    |   1994 | 460170670.541238
 FRANCE                    |   1993 | 460651316.260345
 FRANCE                    |   1992 | 457743147.136961
 GERMANY                   |   1998 | 281629260.745725
 GERMANY                   |   1997 | 473848005.734292
 GERMANY                   |   1996 | 476695037.829454
 GERMANY                   |   1995 | 474729168.889586
 GERMANY                   |   1994 | 482089130.383477
 GERMANY                   |   1993 | 474099780.452403
 GERMANY                   |   1992 | 469450668.071698
 INDIA                     |   1998 | 268940761.165914
 INDIA                     |   1997 | 474441275.728663
 INDIA                     |   1996 | 475386583.197695
 INDIA                     |   1995 | 469443544.083497
 INDIA                     |   1994 | 475799962.595005
 INDIA                     |   1993 |   471086581.8778
 INDIA                     |   1992 | 481852803.899778
 INDONESIA                 |   1998 | 270405610.079204
 INDONESIA                 |   1997 | 461513953.346773
 INDONESIA                 |   1996 | 470155687.582728
 INDONESIA                 |   1995 | 464784995.419906
 INDONESIA                 |   1994 | 472359114.483643
 INDONESIA                 |   1993 |  465111308.47185
 INDONESIA                 |   1992 | 471371581.596773
 IRAN                      |   1998 |   275988664.8333
 IRAN                      |   1997 | 462016597.899203
 IRAN                      |   1996 | 461662953.152261
 IRAN                      |   1995 | 461618187.959674
 IRAN                      |   1994 | 461977403.520727
 IRAN                      |   1993 | 454583980.343971
 IRAN                      |   1992 | 459471639.101506
 IRAQ                      |   1998 |  272585650.18575
 IRAQ                      |   1997 | 471869474.110005
 IRAQ                      |   1996 | 469196844.486947
 IRAQ                      |   1995 | 471208226.956101
 IRAQ                      |   1994 | 474720276.200012
 IRAQ                      |   1993 | 469779723.481703
 IRAQ                      |   1992 |  473711398.22188
 JAPAN                     |   1998 | 274047695.733177
 JAPAN                     |   1997 | 470731615.069958
 JAPAN                     |   1996 | 466998478.106179
 JAPAN                     |   1995 | 468292181.662434
 JAPAN                     |   1994 | 471597724.220458
 JAPAN                     |   1993 | 472535023.845344
 JAPAN                     |   1992 | 462181273.326895
 JORDAN                    |   1998 | 273601297.652367
 JORDAN                    |   1997 | 462903365.884857
 JORDAN                    |   1996 | 459399549.668722
 JORDAN                    |   1995 | 462056598.967358
 JORDAN                    |   1994 | 466372960.585343
 JORDAN                    |   1993 | 465002381.784682
 JORDAN                    |   1992 | 454150072.604533
 KENYA                     |   1998 | 280248751.945425
 KENYA                     |   1997 | 473244775.330209
 KENYA                     |   1996 | 477524385.323337
 KENYA                     |   1995 | 468383911.117007
 KENYA                     |   1994 |   473847564.5201
 KENYA                     |   1993 | 478720644.140122
 KENYA                     |   1992 | 482978412.383716
 MOROCCO                   |   1998 |  270007737.59666
 MOROCCO                   |   1997 | 466860716.054131
 MOROCCO                   |   1996 | 466828546.138896
 MOROCCO                   |   1995 | 476658019.067046
 MOROCCO                   |   1994 | 472509039.018186
 MOROCCO                   |   1993 | 465066627.008481
 MOROCCO                   |   1992 | 465235231.374362
 MOZAMBIQUE                |   1998 | 271452618.834959
 MOZAMBIQUE                |   1997 | 457834185.224594
 MOZAMBIQUE                |   1996 | 460138276.378296
 MOZAMBIQUE                |   1995 | 458317002.987216
 MOZAMBIQUE                |   1994 | 457854624.255416
 MOZAMBIQUE                |   1993 | 455224990.236802
 MOZAMBIQUE                |   1992 | 456323857.550258
 PERU                      |   1998 | 276689749.494617
 PERU                      |   1997 | 465091051.265285
 PERU                      |   1996 | 476374628.845478
 PERU                      |   1995 | 466396682.759629
 PERU                      |   1994 | 466831000.651822
 PERU                      |   1993 | 470913309.608683
 PERU                      |   1992 | 460115648.392136
 ROMANIA                   |   1998 | 271380365.574181
 ROMANIA                   |   1997 | 457514795.836215
 ROMANIA                   |   1996 | 464858860.352435
 ROMANIA                   |   1995 | 458747098.141052
 ROMANIA                   |   1994 | 458350973.872352
 ROMANIA                   |   1993 | 459512110.614673
 ROMANIA                   |   1992 | 469659191.791564
 RUSSIA                    |   1998 | 276425026.382486
 RUSSIA                    |   1997 | 475472604.016618
 RUSSIA                    |   1996 | 469698869.466551
 RUSSIA                    |   1995 | 472261567.647762
 RUSSIA                    |   1994 | 475531696.438109
 RUSSIA                    |   1993 | 473496505.032092
 RUSSIA                    |   1992 |  475446240.90711
 SAUDI ARABIA              |   1998 | 278743431.667558
 SAUDI ARABIA              |   1997 | 471642125.205716
 SAUDI ARABIA              |   1996 | 479428392.372772
 SAUDI ARABIA              |   1995 | 473937408.304754
 SAUDI ARABIA              |   1994 | 472881336.525873
 SAUDI ARABIA              |   1993 | 476175462.840263
 SAUDI ARABIA              |   1992 | 476118096.342558
 UNITED KINGDOM            |   1998 | 272302341.261281
 UNITED KINGDOM            |   1997 | 459183202.396659
 UNITED KINGDOM            |   1996 | 465324791.533361
 UNITED KINGDOM            |   1995 | 468286443.606057
 UNITED KINGDOM            |   1994 | 456374425.275184
 UNITED KINGDOM            |   1993 | 461113933.510629
 UNITED KINGDOM            |   1992 | 463534425.501182
 UNITED STATES             |   1998 | 282279327.135128
 UNITED STATES             |   1997 | 468909555.930059
 UNITED STATES             |   1996 | 476885858.965817
 UNITED STATES             |   1995 | 479185114.894992
 UNITED STATES             |   1994 | 475201001.437602
 UNITED STATES             |   1993 | 475708530.985569
 UNITED STATES             |   1992 | 478249974.048408
 VIETNAM                   |   1998 | 270617425.552917
 VIETNAM                   |   1997 | 466476174.177252
 VIETNAM                   |   1996 | 463062505.675663
 VIETNAM                   |   1995 | 454721131.013188
 VIETNAM                   |   1994 | 457847163.893064
 VIETNAM                   |   1993 | 468223792.056373
 VIETNAM                   |   1992 | 465352125.434523
(175 rows)

COMMIT;
COMMIT
