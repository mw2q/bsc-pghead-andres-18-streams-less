BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lemon%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 265457179.215833
 ALGERIA                   |   1997 | 446667524.040105
 ALGERIA                   |   1996 | 455952666.423555
 ALGERIA                   |   1995 | 451549400.133363
 ALGERIA                   |   1994 | 458433087.421618
 ALGERIA                   |   1993 | 453546622.329038
 ALGERIA                   |   1992 | 446353840.250908
 ARGENTINA                 |   1998 | 276869606.324485
 ARGENTINA                 |   1997 | 464104768.496219
 ARGENTINA                 |   1996 | 464249587.193851
 ARGENTINA                 |   1995 | 467207309.997877
 ARGENTINA                 |   1994 | 470144129.227521
 ARGENTINA                 |   1993 |  465668325.84534
 ARGENTINA                 |   1992 | 458852303.095954
 BRAZIL                    |   1998 | 280723047.563738
 BRAZIL                    |   1997 | 479576715.472522
 BRAZIL                    |   1996 | 480662638.011339
 BRAZIL                    |   1995 | 465579339.722295
 BRAZIL                    |   1994 | 465515230.162567
 BRAZIL                    |   1993 | 473425963.176505
 BRAZIL                    |   1992 | 475299962.811408
 CANADA                    |   1998 | 276662048.064319
 CANADA                    |   1997 | 475478938.780312
 CANADA                    |   1996 | 480586559.597766
 CANADA                    |   1995 | 476906349.506164
 CANADA                    |   1994 | 480543288.186906
 CANADA                    |   1993 | 473964495.339733
 CANADA                    |   1992 | 476893841.060799
 CHINA                     |   1998 | 266607671.355668
 CHINA                     |   1997 | 466887701.971766
 CHINA                     |   1996 | 468581475.839442
 CHINA                     |   1995 |  462693284.70475
 CHINA                     |   1994 | 458604650.468033
 CHINA                     |   1993 | 464153008.925386
 CHINA                     |   1992 | 462504109.383876
 EGYPT                     |   1998 | 268249135.897859
 EGYPT                     |   1997 | 458867774.273604
 EGYPT                     |   1996 | 463113202.722448
 EGYPT                     |   1995 | 454656956.045952
 EGYPT                     |   1994 | 467217358.626495
 EGYPT                     |   1993 | 471939450.844493
 EGYPT                     |   1992 | 464984460.775383
 ETHIOPIA                  |   1998 |  274986309.55654
 ETHIOPIA                  |   1997 | 460623419.736937
 ETHIOPIA                  |   1996 | 469939213.437122
 ETHIOPIA                  |   1995 | 468857714.970341
 ETHIOPIA                  |   1994 | 468490144.345363
 ETHIOPIA                  |   1993 | 467118147.901135
 ETHIOPIA                  |   1992 | 463912428.006417
 FRANCE                    |   1998 | 268574934.413798
 FRANCE                    |   1997 | 453347241.710421
 FRANCE                    |   1996 |  466642068.31045
 FRANCE                    |   1995 | 455786300.839882
 FRANCE                    |   1994 | 460344329.271005
 FRANCE                    |   1993 | 458395782.447188
 FRANCE                    |   1992 | 450147900.012691
 GERMANY                   |   1998 | 278723333.121825
 GERMANY                   |   1997 |  479070006.80293
 GERMANY                   |   1996 | 479219152.533529
 GERMANY                   |   1995 | 475273088.956546
 GERMANY                   |   1994 | 472470365.120109
 GERMANY                   |   1993 | 466165053.273846
 GERMANY                   |   1992 | 482497214.053866
 INDIA                     |   1998 | 279564579.537637
 INDIA                     |   1997 | 478136916.524784
 INDIA                     |   1996 | 477746466.591858
 INDIA                     |   1995 | 473130375.781455
 INDIA                     |   1994 | 476537246.950857
 INDIA                     |   1993 | 472674460.782535
 INDIA                     |   1992 | 482499865.142804
 INDONESIA                 |   1998 | 269947899.621282
 INDONESIA                 |   1997 | 453824543.479228
 INDONESIA                 |   1996 | 452563952.771098
 INDONESIA                 |   1995 | 452279061.857648
 INDONESIA                 |   1994 | 453280297.086219
 INDONESIA                 |   1993 |  459966414.66866
 INDONESIA                 |   1992 | 460158410.739696
 IRAN                      |   1998 | 269560605.168393
 IRAN                      |   1997 | 463659960.481197
 IRAN                      |   1996 | 472228643.838314
 IRAN                      |   1995 | 464272914.243575
 IRAN                      |   1994 | 464542398.281626
 IRAN                      |   1993 | 463685685.400739
 IRAN                      |   1992 | 471729350.264461
 IRAQ                      |   1998 | 280052316.424968
 IRAQ                      |   1997 |  476253885.55925
 IRAQ                      |   1996 | 472698379.230507
 IRAQ                      |   1995 | 477200726.952638
 IRAQ                      |   1994 | 476880730.719949
 IRAQ                      |   1993 | 477793266.417058
 IRAQ                      |   1992 | 473720184.728398
 JAPAN                     |   1998 |  266568726.11842
 JAPAN                     |   1997 | 464602677.654753
 JAPAN                     |   1996 | 466534276.509522
 JAPAN                     |   1995 | 466341704.293492
 JAPAN                     |   1994 | 467583313.438537
 JAPAN                     |   1993 | 467561569.277839
 JAPAN                     |   1992 | 468323209.328946
 JORDAN                    |   1998 | 273364367.938143
 JORDAN                    |   1997 | 463808581.026929
 JORDAN                    |   1996 | 469947821.080712
 JORDAN                    |   1995 | 473302210.871042
 JORDAN                    |   1994 | 465700112.111913
 JORDAN                    |   1993 | 462961927.326329
 JORDAN                    |   1992 |  456784544.20458
 KENYA                     |   1998 | 274972706.727342
 KENYA                     |   1997 | 465939451.474229
 KENYA                     |   1996 |  468340372.02881
 KENYA                     |   1995 |  466929416.24562
 KENYA                     |   1994 | 465991004.951292
 KENYA                     |   1993 | 470421089.320326
 KENYA                     |   1992 | 472058369.827864
 MOROCCO                   |   1998 | 270637649.797667
 MOROCCO                   |   1997 | 465082388.237645
 MOROCCO                   |   1996 | 466079100.245104
 MOROCCO                   |   1995 | 464942408.991214
 MOROCCO                   |   1994 | 472786232.836222
 MOROCCO                   |   1993 | 467971204.887612
 MOROCCO                   |   1992 |  467166107.03329
 MOZAMBIQUE                |   1998 | 268631867.956682
 MOZAMBIQUE                |   1997 | 464591508.060023
 MOZAMBIQUE                |   1996 | 466568147.736653
 MOZAMBIQUE                |   1995 | 464936134.823635
 MOZAMBIQUE                |   1994 | 457177873.933093
 MOZAMBIQUE                |   1993 | 455730439.513867
 MOZAMBIQUE                |   1992 | 459895952.843786
 PERU                      |   1998 | 274093071.755467
 PERU                      |   1997 | 472144263.237385
 PERU                      |   1996 | 472128796.945992
 PERU                      |   1995 | 473271834.106728
 PERU                      |   1994 | 464686556.600101
 PERU                      |   1993 | 471557869.627634
 PERU                      |   1992 | 475986370.967744
 ROMANIA                   |   1998 | 271003681.698232
 ROMANIA                   |   1997 | 472941810.252625
 ROMANIA                   |   1996 | 469453539.812832
 ROMANIA                   |   1995 | 465983690.929481
 ROMANIA                   |   1994 | 462624322.239415
 ROMANIA                   |   1993 | 473556108.969551
 ROMANIA                   |   1992 | 474305624.596268
 RUSSIA                    |   1998 | 279609458.019261
 RUSSIA                    |   1997 | 466048011.281463
 RUSSIA                    |   1996 | 475558461.443803
 RUSSIA                    |   1995 | 469381789.573145
 RUSSIA                    |   1994 | 467238631.111077
 RUSSIA                    |   1993 | 472848264.832321
 RUSSIA                    |   1992 | 465920368.968522
 SAUDI ARABIA              |   1998 | 274151271.542015
 SAUDI ARABIA              |   1997 | 467864419.968492
 SAUDI ARABIA              |   1996 | 468084909.343117
 SAUDI ARABIA              |   1995 | 473334056.051256
 SAUDI ARABIA              |   1994 | 462744886.379954
 SAUDI ARABIA              |   1993 | 470857444.002181
 SAUDI ARABIA              |   1992 | 475349273.930235
 UNITED KINGDOM            |   1998 | 270779547.646932
 UNITED KINGDOM            |   1997 | 458912672.626128
 UNITED KINGDOM            |   1996 | 462846770.343479
 UNITED KINGDOM            |   1995 | 463132712.933588
 UNITED KINGDOM            |   1994 | 458791369.266947
 UNITED KINGDOM            |   1993 | 462235840.936047
 UNITED KINGDOM            |   1992 | 460186871.511331
 UNITED STATES             |   1998 | 274083276.259712
 UNITED STATES             |   1997 | 472205304.399889
 UNITED STATES             |   1996 | 481255190.629337
 UNITED STATES             |   1995 | 472474973.345294
 UNITED STATES             |   1994 |  474409030.16957
 UNITED STATES             |   1993 | 487572212.592616
 UNITED STATES             |   1992 |  478232430.13058
 VIETNAM                   |   1998 | 270027570.141144
 VIETNAM                   |   1997 | 463015308.669982
 VIETNAM                   |   1996 |  472283166.03937
 VIETNAM                   |   1995 | 467775508.097848
 VIETNAM                   |   1994 | 471816100.899062
 VIETNAM                   |   1993 |  470962953.29399
 VIETNAM                   |   1992 |  466522253.08022
(175 rows)

COMMIT;
COMMIT
